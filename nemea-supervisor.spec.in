Summary: Controller and monitoring module for Nemea
Name: nemea-supervisor
Version: @PACKAGE_VERSION@
Release: @RELEASE@
URL: http://www.liberouter.org/nemea
Source: https://www.liberouter.org/repo/SOURCES/%{name}-%{version}-%{release}.tar.gz
Group: Liberouter
License: BSD
Vendor: CESNET, z.s.p.o.
Packager: @USERNAME@ <@USERMAIL@>
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}
Requires: libtrap libxml2
BuildRequires: gcc make doxygen pkgconfig libtrap-devel libxml2-devel
Provides: nemea-supervisor

%description

%prep
%setup

%build
./configure --prefix=%{_prefix} --libdir=%{_libdir} --sysconfdir=%{_sysconfdir}/nemea --bindir=%{_bindir}/nemea --datarootdir=%{_datarootdir} --docdir=%{_docdir}/nemea-supervisor -q --enable-silent-rules --disable-repobuild;
make -j5

%install
make -j5 DESTDIR=$RPM_BUILD_ROOT install

%post
chkconfig --add nemea-supervisor 2> /dev/null || true
systemctl enable nemea-supervisor.service 2> /dev/null || true
sed '/<name>flow_meter/,/<trapinterfaces>/ s/@NIC_NAME@/'$(route -n | \
   awk '/^0\.0\.0\.0/ {print $NF}')'/' /etc/nemea/supervisor_config.xml > /tmp/sp.xml && \
   mv /tmp/sp.xml /etc/nemea/supervisor_config.xml


%files
%{_bindir}/nemea/*
%{_docdir}/nemea-supervisor/README.md
%{_docdir}/nemea-supervisor/README.munin
%config(noreplace) %{_sysconfdir}/nemea/supervisor_config.xml
%{_sysconfdir}/init.d/nemea-supervisor
%{_datarootdir}/munin/plugins/nemea_supervisor
@SYSTEMD_UNIT_DIR@/nemea-supervisor.service
